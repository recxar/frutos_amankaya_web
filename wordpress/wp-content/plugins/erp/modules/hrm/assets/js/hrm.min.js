!function(l){"use strict";var s={initialize:function(){self=this,l("ul.erp-dashboard-announcement").on("click","a.mark-read",this.dashboard.markAnnouncementRead),l("ul.erp-dashboard-announcement").on("click","a.view-full",this.dashboard.viewAnnouncement),l("ul.erp-dashboard-announcement").on("click",".announcement-title a",this.dashboard.viewAnnouncementTitle),l("body").on("search","input#erp-employee-search-search-input",function(e){self.employee.searchEmployee(""),l("#live-search").remove()}),l("body").on("keyup","input#erp-employee-search-search-input",function(e){13===e.keyCode&&e.preventDefault(),3<=l(this).val().length?self.employee.searchEmployee(l(this).val()):l(this).val().length<3&&(self.employee.searchEmployee(""),l("#live-search").remove())}),l(".input-component").on("click",".list-employee-name",self,self.employee.setEmployee),l("ul.erp-list").on("click",".send-wish",this.dashboard.sendBirthdayWish),l("body").on("click","a#erp-new-dept",this.department.create),l(".erp-hr-depts").on("click","a.submitdelete",this.department.remove),l(".erp-hr-depts").on("click","span.edit a",this.department.edit),l("body").on("click","a#erp-new-designation",this.designation.create),l(".erp-hr-designation").on("click","a.submitdelete",this.designation.remove),l(".erp-hr-designation").on("click","span.edit a",this.designation.edit),l(".erp-hr-employees").on("click","a#erp-employee-new",this.employee.create),l(".erp-hr-employees").on("click","span.edit a",this.employee.edit),l(".erp-hr-employees").on("click","a.submitdelete",this.employee.remove),l(".erp-hr-employees").on("click","a.submitrestore",this.employee.restore),l(".erp-hr-employees").on("click","a#erp-empl-type",this.employee.updateJobStatus),l(".erp-hr-employees").on("click","a#erp-empl-status",this.employee.updateJobStatus),l(".erp-hr-employees").on("click","a#erp-empl-compensation",this.employee.updateJobStatus),l(".erp-hr-employees").on("click","a#erp-empl-jobinfo",this.employee.updateJobStatus),l(".erp-hr-employees").on("click","td.action a.remove",this.employee.removeHistory),l(".erp-hr-employees").on("click","td.action a.edit",this.employee.editHistory),l(".erp-hr-employees").on("click","a#erp-employee-print",this.employee.printData),l("body").on("focusout","input#erp-hr-user-email",this.employee.checkUserEmail),l("body").on("click","a#erp-hr-create-wp-user-to-employee",this.employee.makeUserEmployee),l(".erp-employee-single").on("click","a#erp-employee-terminate",this.employee.terminateEmployee),l(".erp-employee-single").on("click","input#erp-hr-employee-status-update",this.employee.changeEmployeeStatus),l(".erp-hr-employees").on("click","a#erp-empl-performance-reviews",this.employee.updatePerformance),l(".erp-hr-employees").on("click","a#erp-empl-performance-comments",this.employee.updatePerformance),l(".erp-hr-employees").on("click","a#erp-empl-performance-goals",this.employee.updatePerformance),l(".erp-hr-employees").on("click",".performance-tab-wrap td.action a.performance-remove",this.employee.removePerformance),l(".erp-hr-employees").on("click","a#erp-empl-add-exp",this.employee.general.create),l(".erp-hr-employees").on("click","a.work-experience-edit",this.employee.general.create),l(".erp-hr-employees").on("click","a.work-experience-delete",this.employee.general.remove),l(".erp-hr-employees").on("click","a#erp-empl-add-education",this.employee.general.create),l(".erp-hr-employees").on("click","a.education-edit",this.employee.general.create),l(".erp-hr-employees").on("click","a.education-delete",this.employee.general.remove),l("body").on("change","#result_type",self,this.employee.general.selectResultType),l(".erp-hr-employees").on("click","a#erp-empl-add-dependent",this.employee.general.create),l(".erp-hr-employees").on("click","a.dependent-edit",this.employee.general.create),l(".erp-hr-employees").on("click","a.dependent-delete",this.employee.general.remove),l(".erp-hr-employees").on("submit",".note-tab-wrap form",this.employee.addNote),l(".erp-hr-employees").on("click",".note-tab-wrap input#erp-load-notes",this.employee.loadNotes),l(".erp-hr-employees").on("click",".note-tab-wrap a.delete_note",this.employee.deleteNote),l("body").on("click","a#erp-set-emp-photo",this.employee.setPhoto),l("body").on("click","a.erp-remove-photo",this.employee.removePhoto),l("body").on("erp-hr-after-new-dept",this.department.afterNew),l("body").on("erp-hr-after-new-desig",this.designation.afterNew),l("body").on("change",".wp-list-table",function(e){l('.wp-list-table tbody tr th input[type="checkbox"]').is(":checked")?(l(".tablenav .bulkactions").show(),l(".tablenav").css("clear","both"),l(".wperp-filter-dropdown").css("margin-top","-63px")):(l(".tablenav .bulkactions").hide(),l(".tablenav").css("clear","none"),l(".wperp-filter-dropdown").css("margin-top","-53px"))}),l("body").on("click",".wperp-filter-dropdown a",this.employee.toggleFilterDropdown),l(".wperp-filter-dropdown").on("click","#wperp-leave-filter-dropdown",this.employee.toggleLeaveFilterDropdown),l(".wperp-filter-panel-footer").on("click",'input[name="hide_filter"]',this.employee.toggleLeaveFilterDropdown),l(".wperp-filter-panel-footer").on("click",'input[name="leave_filter_reset"]',this.employee.resetLeaveFilterDropdown),l("body").on("click",'input[name="hide_filter"]',function(e){e.preventDefault(),self.employee.toggleFilterDropdown()}),l("body").on("click",'input[name="reset_filter"]',function(e){e.preventDefault(),l("#filter_designation option:selected").prop("selected",!1),l("#filter_department option:selected").prop("selected",!1),l("#filter_employment_type option:selected").prop("selected",!1),l("input[name=filter_employee]").click()}),l("#erp-hr-employee-import-csv").on("click",this.employee.importCsv),l("#erp-hr-employee-export-csv").on("click",this.employee.exportCsv),this.showRequestNotification(),l("body").on("click",'input[name="reset_announcement_filter"]',function(e){e.preventDefault(),l("#start_date").val(""),l("#end_date").val(""),l("#erp-announcement-table-wrap .list-table-inner form").submit()}),l("body").on("click","input[name=filter_announcements]",this.announcement.validateFilterForm),l("tbody#the-list tr td.sent_to span.expand-for-more-ann").click(this.announcement.sentToDetails)},initToggleCheckbox:function(){var r=!1;l("tbody").children().children(".check-column").find(":checkbox").click(function(e){if("undefined"==e.shiftKey)return!0;if(e.shiftKey){if(!r)return!0;checks=l(r).closest("form").find(":checkbox").filter(":visible:enabled"),first=checks.index(r),last=checks.index(this),checked=l(this).prop("checked"),0<first&&0<last&&first!=last&&(sliced=last>first?checks.slice(first,last):checks.slice(last,first),sliced.prop("checked",function(){return!!l(this).closest("tr").is(":visible")&&checked}))}var t=l(r=this).closest("tbody").find(":checkbox").filter(":visible:enabled").not(":checked");return l(this).closest("table").children("thead, tfoot").find(":checkbox").prop("checked",function(){return 0===t.length}),!0}),l("thead, tfoot").find(".check-column :checkbox").on("click.wp-toggle-checkboxes",function(e){var t=l(this),r=t.closest("table"),o=t.prop("checked"),n=e.shiftKey||t.data("wp-toggle");r.children("tbody").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!l(this).is(":hidden,:disabled")&&(n?!l(this).prop("checked"):!!o)}),r.children("thead,  tfoot").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!n&&!!o})})},requiredAlert:function(e){var t=0;if(l("edit"===e?"#erp-employee-edit form":"#erp-new-employee-popup form").find("input, select, textarea").each(function(){l(this).prop("required")&&""===l(this).val()&&t++}),t){var r=wpErpHr.required_field_notice.replace("{count}",t);swal("",r,"warning")}},initDateField:function(){l(".erp-date-field").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"-100:+100"}),l(".erp-hr-date-field").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,yearRange:"-100:-2"})},reloadPage:function(){l(".erp-area-left").load(window.location.href+" #erp-area-left-inner",function(){l(".select2").select2()})},ajaxReq:function(e,t){wp.ajax.send({data:e,success:function(){s.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})},showRequestNotification:function(){var e=".erp-custom-menu-container .erp-nav .requests a",t="span.erp-notification",r=0;wp.ajax.send({data:{action:"erp_hr_get_total_pending_requests"},success:function(e){r=e},error:function(e){r=0}}).then(function(){0<r&&(l(e).find(t).length?l(e+" "+t).html(r):l(e).append(' <span class="erp-notification">'+r+"</span>"))})},dashboard:{markAnnouncementRead:function(e){e.preventDefault();var t=l(this);t.closest("li").hasClass("unread")&&wp.ajax.send("erp_hr_announcement_mark_read",{data:{id:t.data("row_id"),_wpnonce:wpErpHr.nonce},success:function(e){t.closest("li").removeClass("unread").addClass("read"),t.addClass("erp-hide")},error:function(e){alert(e)}})},viewAnnouncementTitle:function(e){e.preventDefault();var t=l(this).closest("li").find("a.view-full");wp.ajax.send("erp_hr_announcement_view",{data:{id:t.data("row_id"),_wpnonce:wpErpHr.nonce},success:function(e){l.erpPopup({title:e.title,button:"",id:"erp-hr-announcement",content:"<p>"+e.content+"</p>",extraClass:"midium"}),t.closest("li").removeClass("unread"),t.siblings(".mark-read").addClass("erp-hide")},error:function(e){alert(e)}})},viewAnnouncement:function(e){e.preventDefault();var t=l(this);wp.ajax.send("erp_hr_announcement_view",{data:{id:t.data("row_id"),_wpnonce:wpErpHr.nonce},success:function(e){l.erpPopup({title:e.title,button:"",id:"erp-hr-announcement",content:"<p>"+e.content+"</p>",extraClass:"midium"}),t.closest("li").removeClass("unread"),t.siblings(".mark-read").addClass("erp-hide")},error:function(e){alert(e)}})},sendBirthdayWish:function(e){e.preventDefault();var t=l(this);l(".wait").show(),t.find("i").hide(),wp.ajax.send("erp_hr_birthday_wish",{data:{employee_user_id:t.data("user_id"),_wpnonce:wpErpHr.nonce},success:function(e){l(".wait").hide(),alert(e)},error:function(e){alert(e)}})}},department:{afterNew:function(e,t){var r=l(".erp-hr-dept-drop-down");wperp.scriptReload("erp_hr_script_reload","tmpl-erp-new-employee"),r.append('<option selected="selected" value="'+t.id+'">'+t.title+"</option>"),r.select2().select2("val",t.id)},reload:function(){l("#erp-dept-table-wrap").load(window.location.href+" #erp-dept-table-wrap",function(){s.initToggleCheckbox()})},tempReload:function(){wperp.scriptReload("erp_hr_new_dept_tmp_reload","tmpl-erp-new-dept")},create:function(e){e.preventDefault();var r=l(this).data("single");l.erpPopup({title:wpErpHr.popup.dept_title,button:wpErpHr.popup.dept_submit,id:"erp-hr-new-department",content:wperp.template("erp-new-dept")().trim(),extraClass:"smaller",onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(e){s.department.reload(),"1"!=r?l("body").trigger("erp-hr-after-new-dept",[e]):s.department.tempReload(),t.closeModal()},error:function(e){t.showError(e)}})}})},edit:function(e){e.preventDefault();var r=l(this);l.erpPopup({title:wpErpHr.popup.dept_update,button:wpErpHr.popup.dept_update,id:"erp-hr-new-department",content:wp.template("erp-new-dept")().trim(),extraClass:"smaller",onReady:function(){var t=this;l("header",t).after(l('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-get-dept",{data:{id:r.data("id"),_wpnonce:wpErpHr.nonce},success:function(e){l(".loader",t).remove(),l("#dept-title",t).val(e.name),l("#dept-desc",t).val(e.data.description),l("#dept-parent",t).val(e.data.parent),l("#dept-lead",t).val(e.data.lead),l("#dept-id",t).val(e.id),l("#dept-action",t).val("erp-hr-update-dept"),l('#dept-parent option[value="'+r.data("id")+'"]',t).attr("disabled","disabled")}})},onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(){s.department.reload(),s.department.tempReload(),t.closeModal()},error:function(e){t.showError(e)}})}})},remove:function(e){e.preventDefault();var t=l(this);confirm(wpErpHr.delConfirmDept)&&wp.ajax.send("erp-hr-del-dept",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id")},success:function(){t.closest("tr").fadeOut("fast",function(){l(this).remove(),s.department.tempReload()})},error:function(e){alert(e)}})}},designation:{afterNew:function(e,t){var r=l(".erp-hr-desi-drop-down");wperp.scriptReload("erp_hr_script_reload","tmpl-erp-new-employee"),r.append('<option selected="selected" value="'+t.id+'">'+t.title+"</option>"),s.employee.select2AddMoreActive("erp-hr-desi-drop-down"),r.select2("val",t.id)},reload:function(){l(".erp-hr-designation").load(window.location.href+" .erp-hr-designation",function(){s.initToggleCheckbox()})},create:function(e){e.preventDefault();var r=l(this).data("single");l.erpPopup({title:wpErpHr.popup.desig_title,button:wpErpHr.popup.desig_submit,id:"erp-hr-new-designation",content:wp.template("erp-new-desig")().trim(),extraClass:"smaller",onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(e){s.designation.reload(),"1"!=r&&l("body").trigger("erp-hr-after-new-desig",[e]),t.closeModal()},error:function(e){t.showError(e)}})}})},edit:function(e){e.preventDefault();var r=l(this);l.erpPopup({title:wpErpHr.popup.desig_update,button:wpErpHr.popup.desig_update,content:wp.template("erp-new-desig")().trim(),id:"erp-hr-new-designation",extraClass:"smaller",onReady:function(){var t=this;l("header",t).after(l('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-get-desig",{data:{id:r.data("id"),_wpnonce:wpErpHr.nonce},success:function(e){l(".loader",t).remove(),l("#desig-title",t).val(e.name),l("#desig-desc",t).val(e.data.description),l("#desig-id",t).val(e.id),l("#desig-action",t).val("erp-hr-update-desig")}})},onSubmit:function(t){wp.ajax.send({data:this.serialize(),success:function(){s.designation.reload(),t.closeModal()},error:function(e){t.showError(e)}})}})},remove:function(e){e.preventDefault();var t=l(this);confirm(wpErpHr.delConfirmDesignation)&&wp.ajax.send("erp-hr-del-desig",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id")},success:function(){t.closest("tr").fadeOut("fast",function(){l(this).remove()})},error:function(e){alert(e)}})}},employee:{reload:function(){l(".erp-hr-employees-wrap").load(window.location.href+" .erp-hr-employees-wrap-inner",function(){s.initToggleCheckbox()})},setPhoto:function(e){var t;e.preventDefault(),e.stopPropagation(),t||(t=wp.media({title:wpErpHr.emp_upload_photo,button:{text:wpErpHr.emp_set_photo}})).on("select",function(){t.state().get("selection").map(function(e){var t='<img src="'+(e=e.toJSON()).url+'" alt="" />';t+='<input type="hidden" id="emp-photo-id" name="personal[photo_id]" value="'+e.id+'" />',t+='<a href="#" class="erp-remove-photo">&times;</a>',l(".photo-container",".erp-employee-form").html(t)})}),t.open()},removePhoto:function(e){e.preventDefault();var t='<img src="'+(wpErpHr.asset_url+"/images/mystery-person.png")+'" alt="">';t+='<input type="hidden" name="personal[photo_id]" id="emp-photo-id" value="0">',t+='<a href="#" id="erp-set-emp-photo" class="button-primary"><i class="fa fa-cloud-upload"></i>'+wpErpHr.emp_upload_photo+"</a>",l(".photo-container",".erp-employee-form").html(t)},importCsv:function(e){void 0!==e&&e.preventDefault();var t=l(this);l.erpPopup({title:t.data("title"),button:t.data("btn"),id:"erp-employee-import",content:wperp.template("erp-employee-import-csv")({}),extraClass:"medium",onReady:function(){var e="#erp-employee-import form.erp-modal-form";l("#erp-employee-csv-import-error").hide(),l("#erp-employee-csv-import-error").html(""),l(e).attr("enctype","multipart/form-data"),l(e).attr("id","import_form"),l("button#erp-employee-sample-csv").on("click",function(e){e.preventDefault();var t=l(this).data("url");window.location.href=t}),l("form#import_form #csv_file").on("change",function(e){e.preventDefault(),this&&s.employee.processCsvImporter(this)})},onSubmit:function(t){l("button[type=submit]",".erp-modal").attr("disabled","disabled"),l("#erp-employee-csv-import-error").hide(),l("#erp-employee-csv-import-error").html("");var e=new FormData(this.get(0));wp.ajax.send({data:e,processData:!1,contentType:!1,success:function(e){t.enableButton(),t.closeModal(),s.employee.reload(),swal("",e,"success")},error:function(e){t.enableButton(),l(".erp-modal-backdrop, .erp-modal").find(".erp-loader").addClass("erp-hide"),l("#erp-employee-csv-import-error").show(),l("#erp-employee-csv-import-error").html(e),l("#import_form > div").animate({scrollTop:0},"fast")}})}})},exportCsv:function(e){void 0!==e&&e.preventDefault();var t=l(this);l.erpPopup({title:t.data("title"),button:t.data("btn"),id:"erp-employee-export",content:wperp.template("erp-employee-export-csv")({}),extraClass:"",onReady:function(){var e="employee",t=wpErpHr.erp_fields[e]?wpErpHr.erp_fields[e].fields:[],r="";l("#erp-employee-export form.erp-modal-form").attr("id","export_form");for(var o=0;o<t.length;o++)r+='<div class="col-1"><label><input type="checkbox" name="fields[]" value="'+t[o]+'"> '+s.employee.strTitleCase(t[o])+"</label></div>";r&&l("form#export_form #fields").html(r),l("#export_form #selecctall").change(function(e){e.preventDefault(),l("#export_form #fields input[type=checkbox]").prop("checked",l(this).prop("checked"))})},onSubmit:function(e){this.unbind("submit"),this.get(0).submit(),e.closeModal()}})},processCsvImporter:function(e){l("#erp-csv-fields-container").show();for(var t="",r="employee",o="",n="",a=wpErpHr.erp_fields[r]?wpErpHr.erp_fields[r].fields:[],i=wpErpHr.erp_fields[r]?wpErpHr.erp_fields[r].required_fields:[],p=0;p<a.length;p++)n=-1!==i.indexOf(a[p])?(o="required",' <span class="required">*</span>'):o="",t+='<tr><th><label for="fields['+a[p]+']" class="csv_field_labels">'+s.employee.strTitleCase(a[p])+n+'</label></th><td><select name="fields['+a[p]+']" class="csv_fields" '+o+"></select></td></tr>";l("#erp-csv-fields-container").html(t),s.employee.mapCsvFields(e,".csv_fields")},mapCsvFields:function(e,o){var t=e.files[0],n=new FileReader,r=t.slice(0,5e3);n.readAsText(r),n.onload=function(e){var t=n.result.split("\n")[0].split(","),r="";r+='<option value="">&mdash; Select Field &mdash;</option>',t.forEach(function(e,t){e=e.replace(/"/g,""),r+='<option value="'+t+'">'+e+"</option>"}),r&&(l(o).html(r),l(o).each(function(){var t=l(this).parent().parent().find("label").text(),e=l(this).find("option"),r=l(e).filter(function(){var e=l(this).html();return new RegExp(t,"i").test(e)});r&&(l(e).removeAttr("selected"),l(this).val(l(r).val()))}))}},strTitleCase:function(e){return e.replace(/_/g," ").toLowerCase().split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(" ")},create:function(e){void 0!==e&&e.preventDefault(),void 0!==wpErpHr.employee_empty&&l.erpPopup({title:wpErpHr.popup.employee_title,button:wpErpHr.popup.employee_create,id:"erp-new-employee-popup",content:wperp.template("erp-new-employee")(wpErpHr.employee_empty).trim(),onReady:function(){s.initDateField(),l(".select2").select2(),s.employee.select2Action("erp-hrm-select2"),s.employee.select2AddMoreContent(),l("#user_notification").on("click",function(){l(this).is(":checked")?l(".show-if-notification").show():l(".show-if-notification").hide()}),l("#advanced_fields").click(function(){l(this).is(" :checked ")?(l(".employee-work").show(),l(".employee-personal").show()):(l(".employee-work").hide(),l(".employee-personal").hide())}),l("button[type=submit]").click(s.requiredAlert)},onSubmit:function(t){l("button[type=submit]",".erp-modal").attr("disabled","disabled"),wp.ajax.send("erp-hr-employee-new",{data:this.serialize(),success:function(e){t.enableButton(),t.closeModal(),void 0!==e.url&&(window.location.href=e.url)},error:function(e){t.enableButton(),t.showError(e)}})}})},select2AddMoreContent:function(){var e=l(".erp-hrm-select2-add-more");l.each(e,function(e,t){s.employee.select2AddMoreActive(t)})},select2AddMoreActive:function(e){var t=l(e).data("id"),r=l(e).data("add");void 0!==r&&0<r.length?l(e).select2().on("select2:open",function(){l(".select2-results:not(:has(a))").append('<div class="erp-select2-add"><a href="#" id="'+t+'">'+r+"</a></div>")}):l(e).select2({width:"element",language:{noResults:function(){return'<a href="#" class="button button-primary" id="'+t+'">Add New</a>'}},escapeMarkup:function(e){return e}})},select2Action:function(e){l("."+e).select2({width:"element"})},edit:function(e){e.preventDefault();var t=l(this);l.erpPopup({title:wpErpHr.popup.employee_update,button:wpErpHr.popup.employee_update,id:"erp-employee-edit",onReady:function(){var r=this;l("header",r).after(l('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-emp-get",{data:{id:t.data("id"),_wpnonce:wpErpHr.nonce},success:function(e){var t=wp.template("erp-new-employee")(e);l(".content",r).html(t),l(".loader",r).remove(),s.initDateField(),l(".select2").select2(),s.employee.select2Action("erp-hrm-select2"),s.employee.select2AddMoreContent(),l("#advanced_fields").click(function(){l(this).is(" :checked ")?(l(".employee-work").show(),l(".employee-personal").show()):(l(".employee-work").hide(),l(".employee-personal").hide())}),l("div[data-selected]",r).each(function(){var e=l(this),r=0,o=e.data("selected"),n=l("span.checkbox input[type=checkbox][required]");""!==o&&(e.find("select").val(o).trigger("change"),e.find("input[type=radio][value='"+o+"']").prop("checked",!0),l.each(e.find("input[type=checkbox]"),function(e,t){-1!=l.inArray(l(t).val(),o.split(","))?l(t).prop("checked",!0):l.inArray(l(t),n)&&r++}),r!==n.length&&l.each(e.find("span.checkbox input[type=checkbox][required]"),function(e,t){-1==l.inArray(l(t).val(),o.split(","))&&l(t).removeAttr("required")}))}),l('#work_reporting_to option[value="'+e.id+'"]',r).attr("disabled","disabled")}}),l("button[type=submit]").click(function(){s.requiredAlert("edit")})},onSubmit:function(t){t.disableButton(),wp.ajax.send({data:this.serialize(),success:function(e){s.employee.reload(),t.enableButton(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},remove:function(e){e.preventDefault();var t=l(this);confirm(wpErpHr.delConfirmEmployee)&&wp.ajax.send("erp-hr-emp-delete",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id"),hard:t.data("hard")},success:function(){t.closest("tr").fadeOut("fast",function(){l(this).remove(),s.employee.reload()})},error:function(e){alert(e)}})},restore:function(e){e.preventDefault();var t=l(this);confirm(wpErpHr.restoreConfirmEmployee)&&wp.ajax.send("erp-hr-emp-restore",{data:{_wpnonce:wpErpHr.nonce,id:t.data("id")},success:function(){t.closest("tr").fadeOut("fast",function(){l(this).remove(),s.employee.reload()})},error:function(e){alert(e)}})},toggleFilterDropdown:function(){l("#erp-dropdown-content").toggleClass("show")},toggleLeaveFilterDropdown:function(){l("#erp-leave-dropdown-content").toggleClass("show")},resetLeaveFilterDropdown:function(e){l("#employee_name").val(""),l("#financial_year").val(""),l("#leave_policy").val(""),l("#filter_leave_year").val(""),l("#custom-input").remove(),l(".filter_leave_status").removeAttr("checked");var t=l(e.target).attr("data-url");window.location=t},general:{create:function(e){void 0!==e&&e.preventDefault();var t=l(this);l.erpPopup({title:t.data("title"),content:wp.template(t.data("template"))(t.data("data")),extraClass:"smaller",id:"erp-hr-new-general",button:t.data("button"),onReady:function(){s.initDateField(),l(".row[data-selected]",this).each(function(){var e=l(this),t=e.data("selected");""!==t&&e.find("select").val(t),"percentage"===t&&(l(".education-form-wrap #scale").removeAttr("required"),l(".education-form-wrap #result_scale").fadeOut())})},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){s.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},remove:function(e){e.preventDefault();var t=l(this);confirm(wpErpHr.confirm)&&wp.ajax.send(t.data("action"),{data:{id:t.data("id"),employee_id:t.data("employee_id"),_wpnonce:wpErpHr.nonce},success:function(){s.reloadPage()},error:function(e){alert(e)}})},selectResultType:function(e){"percentage"===l(this).val()?(l(".education-form-wrap #result_area label").html("Result (%) <span class='required'>*</span>"),l(".education-form-wrap #gpa").attr("placeholder","100"),l(".education-form-wrap #scale").removeAttr("required"),l(".education-form-wrap #result_scale").fadeOut()):(l(".education-form-wrap #result_area label").html("Result (Grade) <span class='required'>*</span>"),l(".education-form-wrap #gpa").attr("placeholder","5.0"),l(".education-form-wrap #scale").attr("required","required"),l(".education-form-wrap #result_scale").fadeIn())}},updateJobStatus:function(e){void 0!==e&&e.preventDefault();var o=l(this),n="",a="";wp.ajax.send({data:{id:l("#erp-empl-status").data("id"),action:"erp-hr-emp-get",_wpnonce:wpErpHr.nonce},success:function(t){n=t.work.status,a=t.work.type,l.erpPopup({title:o.data("title"),button:wpErpHr.popup.update_status,id:"erp-hr-update-job-status",content:"",extraClass:"smaller",onReady:function(){t.date=wpErpHr.currentDate;var e=wp.template(o.data("template"))(t);l(".content",this).html(e),l(".row[data-selected]",this).each(function(){var e=l(this),t=e.data("selected");""!==t&&e.find("select").val(t)}),s.employee.select2Action("erp-hrm-select2"),s.initDateField()},onSubmit:function(e){var r=this.serializeObject();r.status?n==r.status?(e.closeModal(),swal("",wpErpHr.popup.already_selected,"error")):"terminated"==r.status?(e.closeModal(),l.erpPopup({title:o.data("title"),button:wpErpHr.popup.terminate,id:"erp-hr-employee-terminate",content:"",extraClass:"smaller",onReady:function(){var e=wp.template("erp-employment-terminate")(r);l(".content",this).html(e),s.initDateField()},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){s.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})):"active"==r.status?(e.closeModal(),l.erpPopup({title:wpErpHr.popup.employment_type,button:wpErpHr.popup.update_status,id:"erp-hr-update-job-status",content:"",extraClass:"smaller",onReady:function(){var e=wp.template("erp-employment-type")(r);l(".content",this).html(e),s.initDateField()},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){s.ajaxReq(r,t)},error:function(e){t.enableButton(),t.showError(e)}})}})):s.ajaxReq(r,e):r.type&&a==r.type?(e.closeModal(),swal("",wpErpHr.popup.already_selected,"error")):s.ajaxReq(r,e)}})}})},removeHistory:function(e){e.preventDefault(),confirm(wpErpHr.confirm)&&wp.ajax.send("erp-hr-emp-delete-history",{data:{history_id:l(this).data("id"),user_id:wpErpCurrentEmployee.user_id,_wpnonce:wpErpHr.nonce},success:function(){s.reloadPage()}})},editHistory:function(e){void 0!==e&&e.preventDefault();var t=l(this),r=t.data("id"),o=t.data("title"),n=t.data("template");wp.ajax.send({data:{history_id:r,action:"erp_hr_employee_get_job_history",_wpnonce:wpErpHr.nonce},success:function(e){l.erpPopup({title:o,button:wpErpHr.popup.update_status,id:"erp-hr-update-job-history",content:"",extraClass:"smaller",onReady:function(){l(".content",this).html(wp.template(n)(e)),s.initDateField(),l(".row[data-selected]",this).each(function(){var e=l(this),t=e.data("selected");""!==t&&e.find("select").val(t)}),s.employee.select2Action("erp-hrm-select2")},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(e){s.reloadPage(),t.enableButton(),t.closeModal(),swal({title:"",text:e,type:"success",timer:2200,showConfirmButton:!1})},error:function(e){t.enableButton(),swal("",e,"error")}})}})}})},printData:function(e){e.preventDefault(),window.print()},checkUserEmail:function(){var r=l(this),e=r.val(),t=r.closest("form").find("#erp-employee-id").val();return!(""==e||!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e))&&("0"==t&&void wp.ajax.send("erp_hr_check_user_exist",{data:{email:e,_wpnonce:wpErpHr.nonce},success:function(){var e=r.closest("form");e.find(".modal-suggession").fadeOut(300,function(){l(this).remove()}),e.find("button[type=submit]").removeAttr("disabled")},error:function(e){var t=r.closest("form");t.find("button[type=submit]").attr("disabled","disabled"),"employee"==e.type&&(t.find(".modal-suggession").remove(),t.find("header.modal-header").append('<div class="modal-suggession">'+wpErpHr.employee_exit+"</div>")),"wp_user"==e.type&&(t.find(".modal-suggession").remove(),t.find("header.modal-header").append('<div class="modal-suggession">'+wpErpHr.make_employee_text+' <a href="#" id="erp-hr-create-wp-user-to-employee" data-user_id="'+e.data.ID+'">'+wpErpHr.create_employee_text+"</a></div>")),l(".modal-suggession").hide().slideDown(function(){t.find(".content-container").css({marginTop:"15px"})})}}))},makeUserEmployee:function(e){e.preventDefault();var t=l(this),o=t.data("user_id");t.closest(".modal-suggession").append('<div class="erp-loader" style="top:9px; right:10px;"></div>'),wp.ajax.send("erp-hr-convert-wp-to-employee",{data:{user_id:o,_wpnonce:wpErpHr.nonce},success:function(){t.closest(".modal-suggession").find(".erp-loader").remove(),t.closest(".erp-modal").remove(),l(".erp-modal-backdrop").remove(),s.employee.reload(),l.erpPopup({title:wpErpHr.popup.employee_update,button:wpErpHr.popup.employee_update,id:"erp-employee-edit",onReady:function(){var r=this;l("header",r).after(l('<div class="loader"></div>').show()),wp.ajax.send("erp-hr-emp-get",{data:{id:o,_wpnonce:wpErpHr.nonce},success:function(e){var t=wp.template("erp-new-employee")(e);l(".content",r).html(t),l(".loader",r).remove(),s.initDateField(),l("div[data-selected]",r).each(function(){var e=l(this),t=e.data("selected");""!==t&&e.find("select").val(t).trigger("change")}),l('#work_reporting_to option[value="'+e.id+'"]',r).attr("disabled","disabled")}})},onSubmit:function(t){t.disableButton(),wp.ajax.send({data:this.serialize(),success:function(e){s.employee.reload(),t.enableButton(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},error:function(e){alert(e)}})},addNote:function(e){e.preventDefault();var r=l(this),o=r.find("input[type=submit]");o.attr("disabled","disabled"),r.find(".erp-note-loader").show(),wp.ajax.send({data:r.serializeObject(),success:function(){l.get(window.location.href,function(e){var t=l("ul.notes-list");t.empty(),0<l(e).find("ul.notes-list li").length?(console.log(l(e).find("ul.notes-list").last(),"last"),t.append(l(e).find("ul.notes-list").last())):(console.log(l(e).find("ul.notes-list li").first(),"first"),t.prepend(l(e).find("ul.notes-list li").first())),10<l("ul.notes-list li").length&&l("ul.notes-list li").last().remove(),s.employee.showLoadMoreBtn(),r.find(".erp-note-loader").hide(),r.find("textarea").val(""),o.removeAttr("disabled")})},error:function(){o.removeAttr("disabled"),r.find(".erp-note-loader").hide()}})},showLoadMoreBtn:function(){10<=l("ul.notes-list li").length?l(".wperp-load-more-btn").show():l(".wperp-load-more-btn").hide()},loadNotes:function(e){e.preventDefault();var t=l(this),r={_wpnonce:wpErpHr.nonce,action:"erp-load-more-notes",user_id:t.data("user_id"),total_no:t.data("total_no"),offset_no:t.data("offset_no")};t.closest("p").append('<span class="erp-loader" style="margin:4px 0px 0px 10px"></span>').find(".erp-loader").show(),t.attr("disabled",!0),wp.ajax.send({data:r,success:function(e){t.data("offset_no",parseInt(r.total_no)+parseInt(r.offset_no)),l(e.content).appendTo(t.closest(".note-tab-wrap").find("ul.notes-list")).hide().fadeIn(),t.removeAttr("disabled"),l(".erp-loader").remove()},error:function(e){alert(e)}})},deleteNote:function(e){if(e.preventDefault(),confirm(wpErpHr.delConfirmEmployeeNote)){var t=l(this),r={action:"erp-delete-employee-note",note_id:t.data("note_id"),user_id:wpErpCurrentEmployee.user_id,_wpnonce:wpErpHr.nonce};wp.ajax.send({data:r,success:function(e){t.closest("li").fadeOut(400,function(){l(this).remove(),s.employee.showLoadMoreBtn()})},error:function(e){alert(e)}})}},updatePerformance:function(e){void 0!==e&&e.preventDefault();var t=l(this);l.erpPopup({title:t.data("title"),button:wpErpHr.popup.update_status,id:"erp-hr-update-performance",content:"",extraClass:"smaller",onReady:function(){var e=wp.template(t.data("template"))(window.wpErpCurrentEmployee);l(".content",this).html(e),s.initDateField(),s.employee.select2Action("erp-hrm-select2"),l(".row[data-selected]",this).each(function(){var e=l(this),t=e.data("selected");""!==t&&e.find("select").val(t)})},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){s.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},removePerformance:function(e){e.preventDefault(),confirm(wpErpHr.confirm)&&wp.ajax.send({data:{action:"erp-hr-emp-delete-performance",id:l(this).data("id"),user_id:l(this).data("userid"),_wpnonce:wpErpHr.nonce},success:function(){s.reloadPage()}})},terminateEmployee:function(e){void 0!==e&&e.preventDefault();var t=l(this),r=t.data("data")?t.data("data"):window.wpErpCurrentEmployee;r.date=wpErpHr.currentDate,l.erpPopup({title:t.data("title"),button:wpErpHr.popup.terminate,id:"erp-hr-employee-terminate",content:"",extraClass:"smaller",onReady:function(){var e=wp.template(t.data("template"))(r);l(".content",this).html(e),s.initDateField(),l(".row[data-selected]",this).each(function(){var e=l(this),t=e.data("selected");""!==t&&e.find("select").val(t)}),s.employee.select2Action("erp-hrm-select2")},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){s.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}})},activateEmployee:function(e){e.preventDefault(),confirm(wpErpHr.confirm)&&wp.ajax.send({data:{action:"erp-hr-emp-activate",id:l(this).data("id"),_wpnonce:wpErpHr.nonce},success:function(){s.reloadPage()}})},changeEmployeeStatus:function(e){e.preventDefault();var r=(a=l(this)).closest("form"),t=r.find("select#erp-hr-employee-status-option"),o=t.val(),n=t.attr("data-selected");if("terminated"==o)o!=n?l.erpPopup({title:a.data("title"),button:wpErpHr.popup.terminate,id:"erp-hr-employee-terminate",content:"",extraClass:"smaller",onReady:function(){var e=wp.template("erp-employment-terminate")({});l(".content",this).html(e),s.initDateField(),s.employee.select2Action("erp-hrm-select2")},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){s.reloadPage(),t.closeModal()},error:function(e){t.enableButton(),t.showError(e)}})}}):alert(wpErpHr.popup.already_terminate);else if("active"==o)if(o!=n){var a=l(this);l.erpPopup({title:wpErpHr.popup.employment_status,button:wpErpHr.popup.update_status,id:"erp-hr-update-job-status",content:"",extraClass:"smaller",onReady:function(){var e=wp.template("erp-employment-type")(window.wpErpCurrentEmployee);l(".content",this).html(e),s.initDateField()},onSubmit:function(t){wp.ajax.send({data:this.serializeObject(),success:function(){t.closeModal(),r.submit()},error:function(e){t.enableButton(),t.showError(e)}})}})}else alert(wpErpHr.popup.already_active);else r.submit()},setEmployee:function(e){e.preventDefault(),l("#erp-employee-search-search-input").val(l(this).data("employee_full_name")),l("#live-search").addClass("hidden")},searchEmployee:function(e){var t=e;l("#live-search").remove(),t.length<3||wp.ajax.send("search_live_employee",{data:{_wpnonce:wpErpHr.nonce,employee_name:t},success:function(e){for(var t='<ul id="live-search"> ',r=0;r<e.length;r++){var o=e[r].work.designation?e[r].work.designation.title:"";t+='<li><span class="employee_name"><div class="list-main">'+e[r].avatar.image+'<div class="list-employee-name" data-employee_full_name="'+e[r].name.full_name+'">'+e[r].name.full_name+'<div class="list-employee-designation">'+o+"</div></div></div></span></li> "}t+="</ul> ",l("#live-employee-search").append(t)},error:function(e){l("#live-search").remove();var t='<ul id="live-search"> ';t+='<li><span class="employee_name"><div class="list-main"><div class="list-employee-name">'+e.data+'<div class="list-employee-designation"></div></div></div></span></li> ',t+="</ul> ",l("#live-employee-search").append(t)}})}},announcement:{validateFilterForm:function(e){e.preventDefault();var t=l("#start_date").val(),r=l("#end_date").val();t&&r?(t=new Date(t).getTime(),(r=new Date(r).getTime())<t?swal(wpErpHr.invalid_filter_data,wpErpHr.start_end_date,"error"):l("#erp-announcement-table-wrap .list-table-inner form").submit()):swal("",wpErpHr.invalid_filter_data,"warning")},sentToDetails:function(e){var t=l(e.target).data("more-content");l.erpPopup({title:wpErpHr.popup.sent_to,button:"",id:"erp-hr-announcement-sent-to-details",content:_.template("<% print( all_send_to ) %>")({all_send_to:t}),extraClass:"smaller"})}}};l(function(){s.initialize()})}(jQuery);